var sAA=9;var sAB=0;var sAC=1;var sAD=2;var sAE=3;var sAF=4;var sAG=5;var sAH=6;var sAI=7;var sAJ=8;sCN();sDD();displayScores();function fileScores(){let sAK;let sAL=document.getElementById('msgLoad');if(sAL){sAK='';sAL.innerHTML=sAK;}let sAM=document.getElementById('errorLoad');if(sAM){sAK='';sAM.innerHTML=sAK;}document.getElementById('upLoad').style.display="block";}function sAN(allText){let sAO=allText.split(/\r\n|\n/);let sAP=sAO.length;let sAQ;let sAR=sAO[0].split(';');let sAS=sAR.length;let sAT=[];let sAU;let sAV;let sAW=[];let sAX=[];for(sAQ=1;sAQ<sAP;sAQ++){sAT=sAO[sAQ].split(';');sAU=sAT.length;if(sAU==sAS){sAW=[];for(sAV=0;sAV<sAS;sAV++){sAW.push(sAR[sAV]+":"+sAT[sAV]);}sAX.push(sAW);}}return sAX;}function sAY(sBF){let sAZ=0;if(sBF && sBF!=''){sBF=sBF.replace(/[0-9]/g,"");if(sBF==''){sAZ=1;}}return sAZ;}function sBA(){let sAX=[];let sAP;let sAQ;let sAT=[];let sBB=[];let sBC=6;let sAU;let sAV;let sBD;let sBE;let sBF;let sBG;let sBH;let sBI;let sBJ;let sBK;let sBL;let sBM=0;let sBN;let sBO;let sAL;let sAK;let sBP=document.getElementById('fileLoad').files[0];let sBQ=new FileReader();sBQ.onload=function(fileLoadedEvent){let sBR=fileLoadedEvent.target.result;let sBS=sBT();sAX=sAN(sBR);sAP=sAX.length;for(sAQ=0;sAQ<sAP;sAQ++){sAT=sAX[sAQ];sAU=sAT.length;if(sAU==sBC){sBD=0;sBG='';for(sAV=0;sAV<sAU;sAV++){sBB=sAT[sAV].split(':');sBE=sBB[0];sBF=sBB[1];switch (sBE){case 'CourseName':sBG=sBF;sBD=sBD+1;break;case 'ChapterId':sBH=sBF;sBD=sBD+sAY(sBF);break;case 'ActivityId':sBI=sBF;sBD=sBD+sAY(sBF);break;case 'ActionId':sBJ=sBF;if(sAY(sBF)==1){if(sBF <= sAA){sBD=sBD+1;}}break;case 'Text':sBK=sBF;sBD=sBD+1;break;case 'ActivityName':sBL=sBF;sBD=sBD+1;break;}}if(sBG==sBS){if(sBD==sBC){updateScores(sBH,sBI,sBJ,sBK,sBL);}else{sBM=sBM+1;}}}if(sBG==sBS && sAU!=sBC){sBM=sBM+1;}}if(sBM!=0){sAM=document.getElementById('errorLoad');if(sAM){if(sBM==1){sBN='avec '+sBM.toString()+' ligne incomplète';}else{sBN='avec '+sBM.toString()+' lignes incomplètes';}sBO='orange';sAK='';sAK += `<span style="color: ${sBO};font-weight: bold;">${sBN}</span>`;sAM.innerHTML=sAK;}}};if(sBP){sBQ.readAsText(sBP,"UTF-8");sBN='Chargement réalisé';sBO='green';}else{sBN='Chargement non réalisé';sBO='red';}sAL=document.getElementById('msgLoad');if(sAL){sAK='';sAK += `<span style="color: ${sBO};font-weight: bold;">${sBN}</span>`;sAL.innerHTML=sAK;}document.getElementById('upLoad').style.display="none";document.getElementById('fileLoad').value='';}function clearDatabase(){localStorage.clear();}function sBT(){let sBU=window.location.href;let sBUTab=sBU.split('/');let sBUNb=sBUTab.length;let sBS=sBUTab[sBUNb-2];return sBS;}function sBX(sBH){let sBY;if(sBH){if(sBH==0){sBY='index.html'}else{sBY='page_'+sBH.toString()+'.html';}}else{let sBZ;let sBU=window.location.href;let sBUTab=sBU.split('/');let sBUNb=sBUTab.length;sBY=sBUTab[sBUNb-1];sBZ=/(\?nav=false)/ig;sBY=sBY.replace(sBZ,"");sBZ=/(#sitenav_[0-9]*.*)/ig;sBY=sBY.replace(sBZ,"");}return sBY;}function sCA(){let sBS=sBT();let sCB='parameters_'+sBS;return sCB;}function sCC(parameterKey){let sCB=sCA();let sCD=localStorage.getItem(sCB);let sCE=[];let sCF;let sCG;let sCH=-1;if(sCD!=null){sCE=JSON.parse(sCD);sCE.forEach(function(element,index){sCF=element.state;sCG=element.time;});if(parameterKey=='state'){sCH=sCF;}if(parameterKey=='time'){sCH=sCG;}}return sCH;}function sCI(parameterKey,sCH){let sCB=sCA();let sCD=localStorage.getItem(sCB);let sCE=[];let sCJ=[];let sCF=0;let sCG=sCK();if(sCD!=null){sCE=JSON.parse(sCD);sCE.forEach(function(element,index){sCF=element.state;sCG=element.time;});}if(parameterKey=='state'){sCF=sCH;}if(parameterKey=='time'){sCG=sCH;}localStorage.removeItem(sCB);sCJ={ state: sCF,time: sCG };sCE=[];sCE.push(sCJ);localStorage.setItem(sCB,JSON.stringify(sCE));}function setQuestionTime(deltaTime,downUp){let sCG=getQuestionTime();sCG=sCG+(deltaTime * downUp);if(sCG<5){sCG=5;}sCI('time',sCG);sCN();}function sCK(){let sCG=20;let sCL=document.getElementById('msgTime');if(sCL){sCG=JSON.parse(sCL.dataset.initialtime);}return sCG;}function getQuestionTime(){let sCG=sCK();let sCM=sCC('time');if(sCM!=-1){sCG=sCM;}return sCG;}function sCN(){let sCG=getQuestionTime();let sCO;let sAK;sCO=document.getElementById('msgTime');if(sCO){sAK='';sAK += `<a>${sCG}</a>`;sCO.innerHTML=sAK;}}function setStateScores(state){sCI('state',state);}function sCP(){let sCQ=0;return sCQ;}function sCR(){let sCQ=sCP();let sCS=sCC('state');if(sCS!=-1){sCQ=sCS;}return sCQ;}function sCT(){let sBS=sBT();let sCB='scores_'+sBS;return sCB;}function resetScores(){let sCB=sCT();localStorage.removeItem(sCB);sDD();}function sCU(){let sCS=sCR();let sCV=document.getElementsByClassName('scores');Array.from(sCV).forEach(function(element){if(sCS==0){element.style.display='none';}else {element.style.display='block';}});}function sCW(text){let sCX=100;if(sCX<text.length){text=text.slice(0,sCX)+' ...';}else{text=text.replace(/<\/br>$/g,'');}return text;}function sCY(text){text=text.replace(/'/g,'&rsquo;');text=text.replace(/"/g,'&quot;');return text;}function sCZ(text){let sBZ=/(\n)/ig;text=text.replace(sBZ,"</br>");return text;}function sDA(text){let sBZ=/([\n\n]+)/ig;text=text.replace(sBZ,"\n");sBZ=/(\n$)/ig;text=text.replace(sBZ,"");return text;}function sDB(sDN){let sBZ=/(score_)/ig;let sBH=sDN.replace(sBZ,"");sBZ=/(_[0-9]*)/ig;sBH=sBH.replace(sBZ,"");return sBH;}function sDC(sDN){let sBZ=/(score_[0-9]*_)/ig;let sBI=sDN.replace(sBZ,"");return sBI;}function sDD(){let sDE;let sDF;let sDG;let sAA;let sDH=[];let sDI;let sDJ;let sDK;let sCB=sCT();let sCD=localStorage.getItem(sCB);let sDL=[];let sDM;let sAK;let sDN;let sBH;let sBI;let sDO;let sDP;let sDQ;let sCG;let sDR;let sDS;let sDT;let sDU;let sDV;let sDW;let sDX;let sDY;let sDZ;let sBN;let sEA;let sBO;if(sCD!=null){sDL=JSON.parse(sCD);sDL.forEach(function(element,index){sDH=element.countTab;sAA=sDH.length;sDJ=element.last;for(sDI=0;sDI<sAA;sDI++){sDK=sDH[sDI];sDE=document.getElementById(element.key+'_'+sDI);if(sDE){sAK='';sAK += `<a>${sDK}&nbsp;&nbsp;</a>`;sDE.innerHTML=sAK;if(sDI==sDJ){sDE.style.fontWeight="bold";}else{sDE.style.fontWeight="normal";}}}sDF=document.getElementById(element.key+'_time');if(sDF){sDM=element.time;sAK='';sAK += `<a>${sDM}</a>`;sDF.innerHTML=sAK;}sDG=document.getElementById(element.key+'_text');if(sDG){sDN=element.key;sBH=sDB(sDN);sBI=sDC(sDN);sDO=element.noteTime;sDP=element.noteEnable;sDQ=element.noteText;sDQ=sCZ(sDQ);sCG=element.questionTime;sDR=element.questionEnable;sDS=element.questionText;sDS=sCZ(sDS);sDW=element.uploadTime;sDX=element.uploadEnable;sDY=element.uploadText;sDY=sCZ(sDY);sDT=element.qcmTime;sDU=element.qcmEnable;sDV=element.qcmText;sAK='';if(sDQ!='' && sDP!=0){sEA='normal';sBO='green';sAK += `<div class="card mx-1 my-1 bg-white text-black thatsMyQuestion" style="width: 16rem;"><div class="card-body"><p class="card-text"><span style="font-size: 0.8rem;">${sDQ}</span></br></br>&nbsp;&nbsp;<span style="color: ${sBO};font-weight: ${sEA};font-size: 0.7rem;">Note&nbsp;:&nbsp;${sDO}</span>&nbsp;&nbsp;<image style="vertical-align: middle;" src="Skin/button_remove.png" onmousedown="Javascript:updateScores('${sBH}','${sBI}','${sAC}');"></image></p></div></div>`;}if(sDS!=''){if(sDR==0){sDZ='';sBN='Question';sEA='normal';sBO='green';}else{sDZ='<image style="vertical-align: middle;" src="Skin/button_ok.png" onmousedown="Javascript:updateScores('+"'"+sBH+"','"+sBI+"','"+sAE+"'"+');"></image>';sBN='Question';sEA='bold';sBO='blue';}sAK += `<div class="card mx-1 my-1 bg-white text-black thatsMyQuestion" style="width: 16rem;"><div class="card-body"><p class="card-text"><span style="font-size: 0.8rem;">${sDS}</span></br></br>${sDZ}&nbsp;&nbsp;<span style="color: ${sBO};font-weight: ${sEA};font-size: 0.7rem;">${sBN}&nbsp;:&nbsp;${sCG}</span>&nbsp;&nbsp;<image style="vertical-align: middle;" src="Skin/button_remove.png" onmousedown="Javascript:updateScores('${sBH}','${sBI}','${sAE}','_');"></image></p></div></div>`;}if(sDV!=''){if(sDU==0){sDZ='';sBN='Feedback';sEA='normal';sBO='green';}else{sDZ='<image style="vertical-align: middle;" src="Skin/button_read.png" onmousedown="Javascript:updateScores('+"'"+sBH+"','"+sBI+"','"+sAJ+"'"+');"></image>';sBN='Feedback';sEA='bold';sBO='red';}sAK += `<div class="card mx-1 my-1 bg-white text-black thatsMyQuestion" style="width: 16rem;"><div class="card-body"><p class="card-text"><span style="font-size: 0.8rem;">${sDV}</span></br>${sDZ}&nbsp;&nbsp;<span style="color: ${sBO};font-weight: ${sEA};font-size: 0.7rem;">${sBN}&nbsp;:&nbsp;${sDT}</span>&nbsp;&nbsp;<image style="vertical-align: middle;" src="Skin/button_remove.png" onmousedown="Javascript:updateScores('${sBH}','${sBI}','${sAJ}','_');"></image></p></div></div>`;}if(sDY!=''){if(sDX==0){sDZ='';sBN='Indication';sEA='normal';sBO='green';}else{sDZ='<image style="vertical-align: middle;" src="Skin/button_ok.png" onmousedown="Javascript:updateScores('+"'"+sBH+"','"+sBI+"','"+sAG+"'"+');"></image>';sBN='Indication';sEA='bold';sBO='orange';}sAK += `<div class="card mx-1 my-1 bg-white text-black thatsMyQuestion" style="width: 16rem;"><div class="card-body"><p class="card-text"><span style="font-size: 0.8rem;">${sDY}</span></br></br>${sDZ}&nbsp;&nbsp;<span style="color: ${sBO};font-weight: ${sEA};font-size: 0.7rem;">${sBN}&nbsp;:&nbsp;${sDW}</span>&nbsp;&nbsp;<image style="vertical-align: middle;" src="Skin/button_remove.png" onmousedown="Javascript:updateScores('${sBH}','${sBI}','${sAG}','_');"></image></p></div></div>`;}sDG.innerHTML=sAK;}});}sCU();}function updateScores(sBH,sBI,sBJ,sBK,sBL){let sDN='score_'+sBH+'_'+sBI;let sEB=document.getElementById(sDN);let sEC='';let sDH=[];let sDI;let sDO='';let sDP=0;let sDQ='';let sCG='';let sDR=0;let sDS='';let sDW='';let sDX=0;let sDY='';let sDT='';let sDU=0;let sDV='';let sCB=sCT();let sCD=localStorage.getItem(sCB);let sDL=[];let sCJ=[];let sED;let sEE=new Date();let sDM=`${sEE.getDate()}/${sEE.getMonth()+1}/${sEE.getFullYear()}  ${sEE.getHours()}:${("0"+(sEE.getMinutes())).slice(-2)}`;let sBY;sBY=sBX(sBH);for(sDI=0;sDI<sAA;sDI++){sDH[sDI]=0;}let sDJ=1;if(sCD!=null){sDL=JSON.parse(sCD);sED=-1;sDL.forEach(function(element,index){if(element.key==sDN){sED=index;sEC=element.block;sDO=element.noteTime;sDP=element.noteEnable;sDQ=element.noteText;sCG=element.questionTime;sDR=element.questionEnable;sDS=element.questionText;sDW=element.uploadTime;sDX=element.uploadEnable;sDY=element.uploadText;sDT=element.qcmTime;sDU=element.qcmEnable;sDV=element.qcmText;sDJ=element.last;sDH=element.countTab;}});if(sED>-1){sDL.splice(sED,1);}}if(sEB){sEC=sEB.dataset.blockname;}else{if(sEC==''){if(sBL){sEC=sBL;}}}if(!sBK){sBK='';}if(sBJ==sAB ||(sBJ==sAC && sDP!=0) ||sBJ==sAD ||(sBJ==sAE && sDR!=0) ||sBJ==sAF ||(sBJ==sAG && sDX!=0) ||sBJ==sAH ||sBJ==sAI ||(sBJ==sAJ && sDU!=0)){sDH[sBJ]=sDH[sBJ]+1;}if(sBJ==sAB){sDP=1;sDQ=sBK;sDO=sDM;}if(sBJ==sAC){sDP=0;sDQ='';}if(sBJ==sAD){sDR=1;sDS=sBK;sCG=sDM;}if(sBJ==sAE){sDR=0;if(sBK=='_'){sDS='';}}if(sBJ==sAF){sDX=1;sDY=sBK;sDW=sDM;}if(sBJ==sAG){sDX=0;if(sBK=='_'){sDY='';}}if(sBJ==sAI && sBK!=''){sDU=1;sDV=sBK;sDT=sDM;}if(sBJ==sAJ){sDU=0;if(sBK=='_'){sDV='';}}if(sBJ==sAH){scoreNum=sDJ;sDV=sBK;}else{scoreNum=sBJ;}sCJ={ key: sDN,time: sDM,url: sBY,block: sEC,noteTime: sDO,noteEnable: sDP,noteText: sDQ,questionTime: sCG,questionEnable: sDR,questionText: sDS,uploadTime: sDW,uploadEnable: sDX,uploadText: sDY,qcmTime: sDT,qcmEnable: sDU,qcmText: sDV,last: scoreNum,countTab : sDH };sDL.push(sCJ);localStorage.setItem(sCB,JSON.stringify(sDL));sDD();displayScores();}function sEF(sBH,sBI,sBJ){let sDN='score_'+sBH+'_'+sBI;let sCB=sCT();let sCD=localStorage.getItem(sCB);let sDL=[];let sBK='';let sDQ='';let sDS='';if(sCD!=null){sDL=JSON.parse(sCD);sDL.forEach(function(element,index){if(element.key==sDN){sDQ=element.noteText;sDS=element.questionText;}});}if(sBJ==sAB){sBK=sDQ;}if(sBJ==sAD){sBK=sDS;}return sBK;}function openText(sBH,sBI,sBJ){let sDN='score_'+sBH+'_'+sBI;let sDG=document.getElementById(sDN+'_read');let sBK=sEF(sBH,sBI,sBJ);let sAK;if(sDG){sAK='';sAK += `<a></a><div class="card-body"><div class="form-group"><textarea id="addText" class="form-control" aria-label="With textarea" style="height:120px;">${sBK}</textarea></div><button onmousedown="Javascript:sEG('${sBH}','${sBI}','${sBJ}');" style="height:25px;width:120px;background-color: white;" id="addBtnx" class="btn btn-outline-primary"><h6 style="color: black;font-size:12px;">Ajouter</h6></button></div>`;sDG.innerHTML=sAK;}}function sEG(sBH,sBI,sBJ){let sDN='score_'+sBH+'_'+sBI;let sEH=document.getElementById('addText');let sBK='';if(sEH){sBK=sEH.value;sBK=sDA(sBK);}let sDG=document.getElementById(sDN+'_read');if(sDG){sAK='';sDG.innerHTML=sAK;}updateScores(sBH,sBI,sBJ,sBK);}function displayScores(itemType){let sBH;let sBI;let sEI;let sBY=sBX();let sAA=0;let sDJ;let sCB=sCT();let sCD=localStorage.getItem(sCB);let sDL=[];let sBO;let sBN;let sEJ;let sEC;let sDN;let sEK;let sDM;let sAK;if(!itemType){itemType=0;}if(sBY.includes('index.html')){sCS=sCR();if(sCS==0){document.getElementById('scores').style.display="none";}else{document.getElementById('scores').style.display="block";}if(sCD!=null){sDL=JSON.parse(sCD);}sAK='';sDL.sort((a,b) => Number((a.uploadEnable+a.questionEnable+a.qcmEnable))-Number((b.uploadEnable+b.questionEnable+b.qcmEnable)));sDL.sort((a,b) => {if(a.key<b.key)return -1;if(a.key>b.key)return 1;return 0;});sDL.forEach(function(element,index){sDP=element.noteEnable;sDR=element.questionEnable;sDX=element.uploadEnable;sDU=element.qcmEnable;if(sDP!=0 || sDR!=0 || sDX!=0 || sDU!=0){sEC=element.block;sDN=element.key;sBH=sDB(sDN);sEJ='('+sBH+')&nbsp;';sBI=sDC(sDN);sEK=element.url+'#sitenav_'+sBI;sDQ=element.noteText;sDO=element.noteTime;if((itemType==1 || itemType==1) && sDP!=0 && sDQ!=''){sAA=sAA+1;sBO='green';sBN='Note :';sDQ=sCZ(sDQ);msgContent=sCW(sDQ);sDQ=sCY(sDQ);sAK += `<div class="card mx-1 my-1 bg-white text-black thatsMyQuestion" style="width: 16rem;"><div class="card-body"><p class="card-text" style="font-size: 0.8rem;"><b><a href="${sEK}"" style="color: ${sBO};">${sEJ}${sEC}</a></b></br><span style="font-size: 0.8rem;">${msgContent}</span><span style="color: black;font-size: 0.7rem"></br></br><b><b><span STYLE="font-size:0.8rem;color:${sBO};"><a onmouseover="nhpup.popup('${sDQ}');">${sBN}</a></span></b>&nbsp;${sDO}</b></span></p></div></div>`;}sDS=element.questionText;sCG=element.questionTime;if((itemType==0 || itemType==2) && sDR!=0 && sDS!=''){sAA=sAA+1;sBO='blue';sBN='Question :';sDS=sCZ(sDS);msgContent=sCW(sDS);sDS=sCY(sDS);sAK += `<div class="card mx-1 my-1 bg-white text-black thatsMyQuestion" style="width: 16rem;"><div class="card-body"><p class="card-text" style="font-size: 0.8rem;"><b><a href="${sEK}"" style="color: ${sBO};">${sEJ}${sEC}</a></b></br><span style="font-size: 0.8rem;">${msgContent}</span><span style="color: black;font-size: 0.7rem"></br></br><b><b><span STYLE="font-size:0.8rem;color:${sBO};"><a onmouseover="nhpup.popup('${sDS}');">${sBN}</a></span></b>&nbsp;${sCG}</b></span></p></div></div>`;}sDV=element.qcmText;sDT=element.qcmTime;if((itemType==0 || itemType==3) && sDU!=0 && sDV!=''){sAA=sAA+1;sBO='red';sBN='Qcm :';msgContent=sCW(sDV);msgContent=msgContent.replace(/color: green;/g,'color: black;');msgContent=msgContent.replace(/color: red;/g,'color: black;');sDV=sCY(sDV);sDV=sDV.replace(/color: green;/g,'color: white;');sDV=sDV.replace(/color: red;/g,'color: white;');sAK += `<div class="card mx-1 my-1 bg-white text-black thatsMyQuestion" style="width: 16rem;"><div class="card-body"><p class="card-text" style="font-size: 0.8rem;"><b><a href="${sEK}"" style="color: ${sBO};">${sEJ}${sEC}</a></b></br><span style="font-size: 0.8rem;">${msgContent}</span><span style="color: black;font-size: 0.7rem"></br></br><b><b><span STYLE="font-size:0.8rem;color:${sBO};"><a onmouseover="nhpup.popup('${sDV}');">${sBN}</a></span></b>&nbsp;${sDT}</b></span></p></div></div>`;}sDY=element.uploadText;sDW=element.uploadTime;if((itemType==0 || itemType==4) && sDX!=0 && sDY!=''){sAA=sAA+1;sBO='orange';sBN='Indication :';msgContent=sCW(sDY);sDY=sCY(sDY);sAK += `<div class="card mx-1 my-1 bg-white text-black thatsMyQuestion" style="width: 16rem;"><div class="card-body"><p class="card-text" style="font-size: 0.8rem;"><b><a href="${sEK}"" style="color: ${sBO};">${sEJ}${sEC}</a></b></br><span style="font-size: 0.8rem;">${msgContent}</span><span style="color: black;font-size: 0.7rem"></br></br><b><b><span STYLE="font-size:0.8rem;color:${sBO};"><a onmouseover="nhpup.popup('${sDY}');">${sBN}</a></span></b>&nbsp;${sDW}</b></span></p></div></div>`;}}});sEI=document.getElementById('scoresList');if(sEI){if(sAA!=0){sEI.innerHTML=sAK;}else{sEI.innerHTML='<h4 style="text-align: center;color: grey;">Aucun élément</h4>';}}}}